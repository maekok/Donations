<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSRF Test - Malicious Site</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #d32f2f; }
        h2 { color: #333; }
        button {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #b71c1c; }
        .success { color: #4caf50; }
        .error { color: #d32f2f; }
        .info { color: #2196f3; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîí CSRF Vulnerability Test</h1>
    <p class="info"><strong>Note:</strong> This is a test page to verify CSRF protection. If CSRF protection is working, these requests should fail.</p>
    
    <div class="test-section">
        <h2>Test 1: Attempt Password Change (No CSRF Token)</h2>
        <p>This attempts to change the admin password without a CSRF token:</p>
        <button onclick="testPasswordChange()">Test Password Change Attack</button>
        <div id="result1"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Attempt Admin Login (No CSRF Token)</h2>
        <p>This attempts to login as admin without a CSRF token:</p>
        <button onclick="testAdminLogin()">Test Admin Login Attack</button>
        <div id="result2"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Attempt Organization Update (No CSRF Token)</h2>
        <p>This attempts to update organization settings without a CSRF token:</p>
        <button onclick="testOrgUpdate()">Test Organization Update Attack</button>
        <div id="result3"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Form-Based Attack (Hidden Form)</h2>
        <p>This simulates a classic CSRF attack using a hidden form:</p>
        <button onclick="testFormAttack()">Test Form-Based Attack</button>
        <div id="result4"></div>
    </div>

    <script>
        // Get the base URL - adjust this to match your server
        const BASE_URL = window.location.protocol + '//' + window.location.host;
        
        function displayResult(elementId, success, message, details) {
            const element = document.getElementById(elementId);
            const statusClass = success ? 'success' : 'error';
            const statusIcon = success ? '‚ùå VULNERABLE' : '‚úÖ PROTECTED';
            element.innerHTML = `
                <p class="${statusClass}"><strong>${statusIcon}:</strong> ${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
        }

        async function testPasswordChange() {
            try {
                const response = await fetch(`${BASE_URL}/goblue/password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include', // Include cookies
                    body: JSON.stringify({
                        currentPassword: 'Quisha',
                        newPassword: 'Hacked123!'
                    })
                });

                const data = await response.json();
                
                if (response.status === 403 || response.status === 400) {
                    displayResult('result1', false, 
                        `CSRF Protection Working! Request blocked with status ${response.status}`,
                        JSON.stringify(data, null, 2));
                } else {
                    displayResult('result1', true, 
                        `‚ö†Ô∏è VULNERABILITY FOUND! Request succeeded with status ${response.status}`,
                        JSON.stringify(data, null, 2));
                }
            } catch (error) {
                displayResult('result1', false, 
                    `CSRF Protection Working! Request failed: ${error.message}`,
                    error.toString());
            }
        }

        async function testAdminLogin() {
            try {
                const response = await fetch(`${BASE_URL}/goblue/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        password: 'Quisha'
                    })
                });

                const data = await response.json();
                
                if (response.status === 403 || response.status === 400) {
                    displayResult('result2', false, 
                        `CSRF Protection Working! Request blocked with status ${response.status}`,
                        JSON.stringify(data, null, 2));
                } else {
                    displayResult('result2', true, 
                        `‚ö†Ô∏è VULNERABILITY FOUND! Request succeeded with status ${response.status}`,
                        JSON.stringify(data, null, 2));
                }
            } catch (error) {
                displayResult('result2', false, 
                    `CSRF Protection Working! Request failed: ${error.message}`,
                    error.toString());
            }
        }

        async function testOrgUpdate() {
            try {
                const response = await fetch(`${BASE_URL}/api/organizations/1`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        name: 'Hacked Organization',
                        email: 'hacker@evil.com'
                    })
                });

                const data = await response.json();
                
                if (response.status === 403 || response.status === 400 || response.status === 401) {
                    displayResult('result3', false, 
                        `CSRF Protection Working! Request blocked with status ${response.status}`,
                        JSON.stringify(data, null, 2));
                } else {
                    displayResult('result3', true, 
                        `‚ö†Ô∏è VULNERABILITY FOUND! Request succeeded with status ${response.status}`,
                        JSON.stringify(data, null, 2));
                }
            } catch (error) {
                displayResult('result3', false, 
                    `CSRF Protection Working! Request failed: ${error.message}`,
                    error.toString());
            }
        }

        function testFormAttack() {
            // Create a hidden form to simulate classic CSRF attack
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `${BASE_URL}/goblue/password`;
            form.style.display = 'none';
            
            const currentPass = document.createElement('input');
            currentPass.type = 'hidden';
            currentPass.name = 'currentPassword';
            currentPass.value = 'Quisha';
            
            const newPass = document.createElement('input');
            newPass.type = 'hidden';
            newPass.name = 'newPassword';
            newPass.value = 'Hacked123!';
            
            form.appendChild(currentPass);
            form.appendChild(newPass);
            document.body.appendChild(form);
            
            // Try to submit the form
            fetch(form.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                credentials: 'include',
                body: new URLSearchParams({
                    currentPassword: 'Quisha',
                    newPassword: 'Hacked123!'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (response.status === 403 || response.status === 400) {
                    displayResult('result4', false, 
                        `CSRF Protection Working! Form submission blocked`,
                        JSON.stringify(data, null, 2));
                } else {
                    displayResult('result4', true, 
                        `‚ö†Ô∏è VULNERABILITY FOUND! Form submission succeeded`,
                        JSON.stringify(data, null, 2));
                }
            })
            .catch(error => {
                displayResult('result4', false, 
                    `CSRF Protection Working! Form submission failed: ${error.message}`,
                    error.toString());
            })
            .finally(() => {
                document.body.removeChild(form);
            });
        }
    </script>
</body>
</html>

